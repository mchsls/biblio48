<!DOCTYPE html>
<html>
<head>
    <title>Синхронизация с системой бронирования</title>
</head>
<body>
    <script>
        // Этот файл открывается из PHP системы для синхронизации входа
        const urlParams = new URLSearchParams(window.location.search);
        const action = urlParams.get('action');
        const userData = urlParams.get('user');
        
        if (action === 'login' && userData) {
            try {
                const user = JSON.parse(decodeURIComponent(userData));
                if (window.opener && !window.opener.closed) {
                    window.opener.syncLibraryLogin(user);
                }
                localStorage.setItem('library_user', JSON.stringify(user));
            } catch (e) {
                console.error('Ошибка синхронизации:', e);
            }
        } else if (action === 'logout') {
            if (window.opener && !window.opener.closed) {
                window.opener.syncLibraryLogout();
            }
            localStorage.removeItem('library_user');
        }
        
        window.close();
    </script>
</body>
</html>